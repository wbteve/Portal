<?php

/**
 * Implements hook_form_alter(&$form, &$form_state, $form_id).
 */
function bg_custom_form_alter(&$form, &$form_state, $form_id) {
  global $language;

  // Remove name from comment form
  if ($form_id == 'comment_node_blog_form') {
    unset($form['author']);
    unset($form['comment_body'][$form['language']['#value']][0]['value']['#title']);
  }
}

function bg_custom_form_comment_form_alter(&$form, &$form_state, &$form_id) {
  $form['comment_body']['#after_build'][] = 'bg_custom_customize_comment_form';
}

function bg_custom_customize_comment_form(&$form) {
  $form[$form['#language']][0]['format']['#access'] = FALSE;
  $form[$form['#language']][0]['#format'] = 'plain_text';
  return $form;
}

/**
 * Implements hook_node_load().
 */
function bg_custom_node_load($nodes, $types) {
  if(arg(0) == 'node') {
    foreach($nodes as &$node){
      if ($node->type == 'media') {
        /*
         * Set Open Graph default image. Open Graph Meta module handles everything else.
         */
        $file     = file_load($node->field_media_file[$node->language][0]['fid']);
        $wrapper  = file_stream_wrapper_get_instance_by_uri($file->uri);

        if($wrapper instanceof BGMediaStreamWrapper || $wrapper instanceof MediaYouTubeStreamWrapper) {
          $uri = $wrapper->getLocalThumbnailPath();
        }
        else if($wrapper instanceof DrupalPublicStreamWrapper) {
          $uri = $file->uri;
        }

        if(isset($uri)) {
          $node->dummy_field_og_image = array(
            'uri'       => $uri,
            'filemime'  => 'image',
          );
        }
      }
    }
  }
}

function bg_custom_block_list_alter(&$blocks) {
  if(arg(0) == 'node' && is_numeric(arg(1))) {
    $node = node_load(arg(1));

    if($node && in_array($node->type, array('flash', 'iframe', 'dossier'))) {
      foreach($blocks as $key => $block) {
        if(in_array($block->region, array('sidebar_first', 'sidebar_second'))) {
          unset($blocks[$key]);
        }
      }
    }
  }
}

/*
 * Implements hook_menu_alter().
 */
function bg_custom_menu_alter(&$items) {
  // Disable the default front page.
  unset($items['node']);
}
